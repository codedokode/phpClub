<?php
/** @var \phpClub\Entity\Thread[] $threads */
/** @var \phpClub\Entity\Thread $thread */
/** @var \phpClub\Entity\File $file */
/** @var \phpClub\Entity\Post $post */
/** @var \phpClub\Service\UrlGenerator $urlGenerator */
use phpClub\Entity\File;
use phpClub\Service\Helper;
?>

<div id="post-<?= $post->getId() ?>" class="<?= ($post->isFirstPost()) ? 'oppost-wrapper' : 'post-wrapper' ?>">
    <div class="post <?= ($post->isFirstPost()) ? 'oppost-wrapper' : 'reply' ?>" id="post-body-<?= $post->getId() ?>" data-num="<?= $post->getId() ?>">

    <div class="post-details" id="post-details-<?= $post->getId() ?>">
    <input name="delete" class="turnmeoff" value="<?= $post->getId() ?>" type="checkbox">

    <span class="post-title"><?= $post->getTitle() ?></span>
    <span class="ananimas"><?= $post->getAuthor() ?></span>

    <span class="posttime-reflink">
        <span class="posttime"><?= $post->getDate()->format('Y/m/d H:i:s') ?>&nbsp;</span>
        <span class="reflink">

            <a href="<?= $urlGenerator->toPostAnchor($post) ?>"
               class="postbtn-reply-href"
               id="<?= $post->getId() ?>">№<?= $post->getId()?></a>
        </span>
    </span>

    <?php if (isset($threads) and $post->isFirstPost()): ?>
        <span class="desktop">
            [<a class="orange" href="<?= $urlGenerator->toThread($thread) ?>">Просмотреть</a>]
        </span>
    <?php endif; ?>

    <?php if ($post->isFirstPost() && isset($thread)) : ?>
        <span class="archive-links">
            <a href="<?= $urlGenerator->toDvachArchiveThread($thread) ?>">
                <img src="<?= $urlGenerator->toDvachIcon() ?>" title="Искать в архиве 2ch.hk">
            </a>
            
            <a href="<?= $urlGenerator->toArhivachThread($thread) ?>">
                <img src="<?= $urlGenerator->toArhivachIcon() ?>" title="Искать в архиваче">
            </a>
            <i class="fa fa-chain"></i>
        </span>
    <?php endif; ?>

    <?php if (!$post->isOld()): ?>
        | <a href="<?= $urlGenerator->toChain($post) ?>">Chain</a>
    <?php endif ?>

    <br class="turnmeoff">
</div>

<?php if ($post->getFiles()->count() > 0) : ?>
    <div class="images <?= ($post->getFiles()->count() > 1) ? 'images-multi' : 'images-single' ?> ">
        <?php /** @var File $file */ ?>
        <?php foreach($post->getFiles() as $file) :?>
            <figure class="image">
                <figcaption class="file-attr">
                    <a class="desktop" target="_blank" href="<?= $file->getPath() ?>" id="title-<?= $post->getId() ?>" title="<?= $file->getName() ?>"><?= $file->getName() ?></a>

                    <span class="filesize">(<?= $file->getSize() ?>, <?= $file->getWidth() ?>x<?= $file->getHeight() ?>)</span>
                </figcaption>

                <div id="exlink-<?= $post->getId() ?>-" class="image-link">
                    <a href="<?= $file->getPath() ?>" target="_blank" onclick="return expand('<?= $post->getId() ?>-','<?= $file->getPath() ?>', '<?= $file->getThumbPath() ?>', '<?= $file->getWidth() ?>', '<?= $file->getHeight() ?>')">
                        <img src="<?= $file->getThumbPath() ?>" alt="<?= $file->getHeight() ?>x<?=$file->getWidth() ?>" class="img preview">
                    </a>
                </div>
            </figure>
        <?php endforeach; ?>
    </div>
<?php endif; ?>

<blockquote id="m<?= $post->getId() ?>" class="post-message">
    <?= $post->getText() ?>
</blockquote>

<div id="refmap-<?= $post->getId() ?>" class="ABU-refmap" style="display: none;"><em>Ответы: </em></div>

<?php if (isset($threads) and $post->isFirstPost()) : ?>
    <div class="oppost-options-mob mobile">
        <div class="hide-view">
            <a href="<?= $urlGenerator->toThread($thread) ?>" class="button-mob">В тред</a>
        </div>
    </div>
<?php endif; ?>
</div>
</div>

<?php if (isset($threads) and $post->isFirstPost()) : ?>
    <span class="mess-post desktop">Нажмите <a href="<?= $urlGenerator->toThread($thread) ?>">Просмотреть</a>, чтобы посмотреть.</span>
<?php endif; ?>
