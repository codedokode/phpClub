<?php
/** @var \phpClub\Entity\Thread[] $threads */
/** @var \phpClub\Entity\File $file */
/** @var \phpClub\Entity\Post $post */
/** @var \phpClub\Service\UrlGenerator $urlGenerator */
use phpClub\Entity\File;
use phpClub\Service\Helper;

?>

<div id="post-<?= $post->getId() ?>" class="<?= ($post->isOpPost()) ? 'oppost-wrapper' : 'post-wrapper' ?>">
    <div class="post <?= ($post->isOpPost()) ? 'oppost-wrapper' : 'reply' ?>" id="post-body-<?= $post->getId() ?>"" data-num="<?= $post->getId() ?>"">

    <div class="post-details" id="post-details-<?= $post->getId() ?>"">
    <input name="delete" class="turnmeoff" value="<?= $post->getId() ?>"" type="checkbox">

    <span class="post-title"><?= $post->getTitle() ?></span>
    <span class="ananimas"><?= $post->getAuthor() ?></span>

    <span class="posttime-reflink">
                <span class="posttime"><?= $post->getDate()->format('Y-m-d') ?>&nbsp;</span>
                <span class="reflink">

                    <a href="/pr/chain/<?= $post->getId() ?>#<?= $post->getId() ?>">№</a><a href="/pr/res/<?= $post->getThread()->getId() ?>.html#<?= $post->getId() ?>" class="postbtn-reply-href" id="<?= $post->getId() ?>"><?= $post->getId() ?></a>
                </span>
            </span>

    <?php if (isset($threads) and $post->isOpPost()) : ?>
        <span class="desktop">
                [<a class="orange" href="<?= $urlGenerator->toThread($post->getThread()) ?>.html">Просмотреть</a>]
                </span>
    <?php endif; ?>

    <?php if ($post->isOpPost()) : ?>
        <span class="archive-links">
            <?php foreach($post->getThread()->getArchiveLinks() as $archiveLink) :?>
                <a href="<?= $archiveLink->getLink() ?>"><img src="<?= Helper::getArchiveIconUrl($archiveLink->getLink())?>"></a>
            <?php endforeach; ?>
        </span>
    <?php endif; ?>

    <br class="turnmeoff">
</div>

<?php if ($post->getFiles()->count() > 0) : ?>
    <div class="images <?= ($post->getFiles()->count() > 1) ? 'images-multi' : 'images-single' ?> ">
        <?php /** @var File $file */ ?>
        <?php foreach($post->getFiles() as $file) :?>
            <figure class="image">
                <figcaption class="file-attr">
                    <a class="desktop" target="_blank" href="<?= $urlGenerator->toFile($file) ?>" id="title-<?= $post->getId() ?>" title="<?= $file->getName() ?>"><?= $file->getName() ?></a>

                    <span class="filesize">(<?= $file->getSize() ?>, <?= $file->getWidth() ?>x<?= $file->getHeight() ?>)</span>
                </figcaption>

                <div id="exlink-<?= $post->getId() ?>-" class="image-link">
                    <a href="<?= $urlGenerator->toFile($file) ?>" target="_blank" onclick="return expand('<?= $post->getId() ?>-','<?= $urlGenerator->toFile($file) ?>', '<?= $urlGenerator->toThumbFile($file) ?>', '<?= $file->getWidth() ?>', '<?= $file->getHeight() ?>')">
                        <img src="<?= $urlGenerator->toThumbFile($file) ?>" alt="<?= $file->getHeight() ?>x<?=$file->getWidth() ?>" class="img preview">
                    </a>
                </div>
            </figure>
        <?php endforeach; ?>
    </div>
<?php endif; ?>

<blockquote id="m<?= $post->getId() ?>" class="post-message">
    <?= $post->getText() ?>
</blockquote>

<div id="refmap-<?= $post->getId() ?>" class="ABU-refmap" style="display: none;"><em>Ответы: </em></div>


<?php if (isset($threads) and $post->isOpPost()) : ?>
    <div class="oppost-options-mob mobile">
        <div class="hide-view">
            <a href="/pr/res/<?= $post->getThread()->getId() ?>.html" class="button-mob">В тред</a>
        </div>
    </div>
<?php endif; ?>
</div>
</div>

<?php if (isset($threads) and $post->isOpPost()) : ?>
    <span class="mess-post desktop">Нажмите <a href="/pr/res/<?= $post->getThread()->getId() ?>.html">Просмотреть</a>, чтобы посмотреть.</span>
<?php endif; ?>
